(()=>{function e(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,o,c,r=[],l=!0,s=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(a=o.call(n)).done)&&(r.push(a.value),r.length!==t);l=!0);}catch(e){s=!0,i=e}finally{try{if(!l&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(s)throw i}}return r}}(e,n)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?t(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}!function(t){"use strict";var n={init:function(){this.initDatePicker(),this.initAddExclusion(),this.initRemoveExclusion(),this.initFormValidation()},initDatePicker:function(){t(".exclusion-date-picker").datepicker({dateFormat:"yy-mm-dd",minDate:0,maxDate:"+2y",showButtonPanel:!0,changeMonth:!0,changeYear:!0,beforeShowDay:function(e){var a=n.getExcludedDates(),i=t.datepicker.formatDate("yy-mm-dd",e);return a.includes(i)?[!1,"excluded-date","Already excluded"]:[!0,"",""]},onSelect:function(e){t(this).val(e),t("#exclusion-reason").focus()}})},getExcludedDates:function(){var e=[];return t("#exclusions-list tr[data-date]").each(function(){e.push(t(this).data("date"))}),e},initAddExclusion:function(){t("#add-exclusion").on("click",function(e){e.preventDefault(),n.addExclusion()}),t("#exclusion-date, #exclusion-reason").on("keypress",function(e){13===e.which&&(e.preventDefault(),n.addExclusion())})},addExclusion:function(){var e=t("#add-exclusion"),a=t("#exclusion-date").val().trim(),i=t("#exclusion-reason").val().trim();return a?this.validateDate(a)?(e.addClass("loading").prop("disabled",!0),void t.ajax({url:wcCollectionDateAdmin.ajax_url,type:"POST",data:{action:"wc_collection_date_add_exclusion",nonce:wcCollectionDateAdmin.nonce,date:a,reason:i},success:function(e){e.success?(n.displaySuccess(e.data.message),n.addExclusionRow(e.data.date,e.data.formatted_date,e.data.reason),t("#exclusion-date, #exclusion-reason").val(""),t("#exclusion-date").datepicker("refresh")):n.displayError(e.data.message)},error:function(e){var t,a=(null===(t=e.responseJSON)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||"An error occurred. Please try again.";n.displayError(a)},complete:function(){e.removeClass("loading").prop("disabled",!1)}})):(alert(wcCollectionDateAdmin.i18n.invalid_date),void t("#exclusion-date").val("").focus()):(alert(wcCollectionDateAdmin.i18n.invalid_date),void t("#exclusion-date").focus())},addExclusionRow:function(e,n,a){var i=t("#exclusions-list");i.find(".no-items").remove();var o=a||"â€”",c=t("<tr></tr>").attr("data-date",e).html('\n                    <td class="column-date">'.concat(this.escapeHtml(n),'</td>\n                    <td class="column-reason">').concat(this.escapeHtml(o),'</td>\n                    <td class="column-actions">\n                        <button type="button"\n                                class="button button-link-delete remove-exclusion"\n                                data-date="').concat(this.escapeAttr(e),'">\n                            Delete\n                        </button>\n                    </td>\n                ')),r=i.find("tr[data-date]").toArray();r.push(c[0]),r.sort(function(e,n){var a=t(e).data("date"),i=t(n).data("date");return a.localeCompare(i)}),i.empty().append(r),c.hide().fadeIn(300)},initRemoveExclusion:function(){t(document).on("click",".remove-exclusion",function(e){if(e.preventDefault(),confirm(wcCollectionDateAdmin.i18n.confirm_delete)){var a=t(this).data("date");n.removeExclusion(a,t(this).closest("tr"))}})},removeExclusion:function(e,a){a.css("opacity","0.5"),t.ajax({url:wcCollectionDateAdmin.ajax_url,type:"POST",data:{action:"wc_collection_date_remove_exclusion",nonce:wcCollectionDateAdmin.nonce,date:e},success:function(e){e.success?(a.fadeOut(300,function(){t(this).remove(),0===t("#exclusions-list tr[data-date]").length&&t("#exclusions-list").html('\n                                    <tr class="no-items">\n                                        <td colspan="3" class="colspanchange">\n                                            No excluded dates.\n                                        </td>\n                                    </tr>\n                                ')}),n.displaySuccess(e.data.message),t("#exclusion-date").datepicker("refresh")):(a.css("opacity","1"),n.displayError(e.data.message))},error:function(e){var t;a.css("opacity","1");var i=(null===(t=e.responseJSON)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||"An error occurred. Please try again.";n.displayError(i)}})},initFormValidation:function(){t("form").on("submit",function(){if(0===t('input[name="wc_collection_date_working_days[]"]:checked').length)return alert("Please select at least one working day."),!1;var e=parseInt(t("#wc_collection_date_lead_time").val(),10);if(isNaN(e)||e<0||e>365)return alert("Lead time must be between 0 and 365 days."),t("#wc_collection_date_lead_time").focus(),!1;var n=parseInt(t("#wc_collection_date_max_booking_days").val(),10);return!(isNaN(n)||n<1||n>365)||(alert("Maximum booking days must be between 1 and 365."),t("#wc_collection_date_max_booking_days").focus(),!1)})},validateDate:function(t){if(!/^\d{4}-\d{2}-\d{2}$/.test(t))return!1;var n=new Date(t),a=e(t.split("-").map(Number),3),i=a[0],o=a[1],c=a[2];return n.getFullYear()===i&&n.getMonth()===o-1&&n.getDate()===c},displaySuccess:function(e){this.displayNotice(e,"success")},displayError:function(e){this.displayNotice(e,"error")},displayNotice:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",a=t("<div></div>").addClass("notice notice-".concat(n," is-dismissible")).html("<p>".concat(this.escapeHtml(e),"</p>"));t(".wc-collection-date-settings h1").after(a),a.hide().fadeIn(300),setTimeout(function(){a.fadeOut(300,function(){t(this).remove()})},5e3),t(document).trigger("wp-updates-notice-added")},escapeHtml:function(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML},escapeAttr:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}};t(document).ready(function(){"undefined"!=typeof wcCollectionDateAdmin&&n.init()})}(jQuery)})();